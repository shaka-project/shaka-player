name: Build and Test

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  workflow_dispatch:

jobs:
  docker_job:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout correct branch (fork-safe)
        uses: actions/checkout@v4
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name || github.repository }}
          ref: ${{ github.event.pull_request.head.sha || github.sha }}
          persist-credentials: false
          fetch-depth: 1

      - name: Debug directory
        run: |
          echo "Working directory:"
          pwd
          echo "Contents:"
          ls -la

      - name: Build Docker Image
        run: docker build . -t myimage:latest

      - name: Run Docker Container
        run: docker run --rm myimage:latest
