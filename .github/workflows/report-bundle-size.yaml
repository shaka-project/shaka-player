name: Report Bundle Size

on:
  workflow_run:
    workflows: ["Build and Test"]
    types:
      - completed

jobs:
  report:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: bundle-size
          path: bundle

      - name: Read PR info
        run: |
          echo "PR_NUMBER=${{ github.event.workflow_run.pull_requests[0].number }}" >> $GITHUB_ENV

      - name: Compute bundle size
        id: size
        run: |
          SIZE=$(du -k bundle/main.js | cut -f1)
          echo "PR_SIZE=$SIZE" >> $GITHUB_ENV

      - name: Comment on PR
        uses: mshick/add-pr-comment@v2
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          issue: ${{ env.PR_NUMBER }}
          message: |
            "**Bundle Size Report**  
            ðŸ§© **New bundle size:** ${{ env.PR_SIZE }} KB"
